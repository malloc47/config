#!/bin/bash
# do this first
# git clone --no-hardlinks /XYZ /ABC
EXPECTED_ARGS=1
E_BADARGS=65
if [ $# -lt $EXPECTED_ARGS ]
then
  echo "Usage: `basename $0` [directory]"
  exit $E_BADARGS
fi
git filter-branch --prune-empty --subdirectory-filter $1 HEAD -- --all
rm -rf .git/refs/original/
git reflog expire --expire=now --all
git gc --aggressive --prune=now
# git repack -ad
git prune
git gc --aggressive
git repack
git repack -ad
git prune-packed
